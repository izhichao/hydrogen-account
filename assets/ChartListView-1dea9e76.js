import{d as P,c as ge,s as ye,b as be,t as o,e as S,g as Ce,h as Se,w as Ve,f as we}from"./elevation-8c8294a2.js";import{f as De,b as Te,s as ze,d as Be,_ as ke,e as $e}from"./loading-aa03f27c.js";import{_ as Ie}from"./DatePickerSfc-af8219b1.js";import{_ as Ne,a as _e}from"./Header-a50ab88d.js";import{_ as Le}from"./ListItem-86f0ac9a.js";import{u as Ue,_ as Me}from"./useChart-53c8b12e.js";import"./ButtonSfc-4ed993c7.js";import{r as te,o as N,c as J,e as E,b as y,w as R,n as j,p as ae,i as Pe,v as Ee,C as Re,d as ve,f as V,x as se,D as fe,y as Fe,j as oe,g as ie,t as Ae,l as ue,F as de,a as qe,u as Oe,h as We,k as Ye,_ as je}from"./index-c9eda65c.js";import{D as G,u as Ge,n as He,a as Je,b as le}from"./useDealStore-7f0e9a3d.js";import{g as H}from"./getNow-e1064b64.js";const pe={modelValue:{type:[String,Number],default:0},min:[String,Number],max:[String,Number],step:{type:[String,Number],default:1},color:String,inputWidth:[String,Number],inputTextSize:[String,Number],buttonSize:[String,Number],elevation:{type:[Boolean,Number,String],default:!0},decimalLength:[String,Number],disabled:Boolean,readonly:Boolean,disableIncrement:Boolean,disableDecrement:Boolean,disableInput:Boolean,lazyChange:Boolean,incrementButton:{type:Boolean,default:!0},decrementButton:{type:Boolean,default:!0},press:{type:Boolean,default:!0},ripple:{type:Boolean,default:!0},validateTrigger:{type:Array,default:()=>["onInputChange","onLazyChange","onIncrement","onDecrement"]},rules:Array,onBeforeChange:P(),onChange:P(),onIncrement:P(),onDecrement:P(),"onUpdate:modelValue":P()},me=100,ce=600,{name:Ke,n:Qe,classes:Xe}=ge("counter"),Ze=["inputmode","readonly","disabled"];function xe(e,h){const B=te("var-icon"),k=te("var-button"),b=te("var-form-details");return N(),J("div",{class:j(e.classes(e.n(),e.n("$--box")))},[E("div",Re({class:e.classes(e.n("controller"),e.formatElevation(e.elevation,2),[e.disabled||e.formDisabled,e.n("--disabled")],[e.errorMessage,e.n("--error")]),style:{background:e.color}},e.$attrs),[y(k,{class:j(e.classes(e.n("decrement-button"),[!e.decrementButton,e.n("--hidden")],[e.disabled||e.formDisabled,e.n("--not-allowed")])),style:ae({width:e.toSizeUnit(e.buttonSize),height:e.toSizeUnit(e.buttonSize)}),round:"","var-counter-cover":"",ripple:e.ripple&&e.decrementButton&&!e.disabled&&!e.formDisabled&&!e.readonly&&!e.formReadonly&&!e.disableDecrement&&!e.isMin,onClick:e.decrement,onTouchstart:e.pressDecrement,onTouchend:e.releaseDecrement,onTouchcancel:e.releaseDecrement},{default:R(()=>[y(B,{name:"minus"})]),_:1},8,["class","style","ripple","onClick","onTouchstart","onTouchend","onTouchcancel"]),Pe(E("input",{class:j(e.classes(e.n("input"),[e.disabled||e.formDisabled,e.n("--not-allowed")])),style:ae({width:e.toSizeUnit(e.inputWidth),fontSize:e.toSizeUnit(e.inputTextSize)}),inputmode:e.toNumber(e.decimalLength)===0?"numeric":"decimal",readonly:e.readonly||e.formReadonly,disabled:e.disabled||e.formDisabled||e.disableInput,"onUpdate:modelValue":h[0]||(h[0]=w=>e.inputValue=w),onChange:h[1]||(h[1]=(...w)=>e.handleChange&&e.handleChange(...w))},null,46,Ze),[[Ee,e.inputValue]]),y(k,{class:j(e.classes(e.n("increment-button"),[!e.incrementButton,e.n("--hidden")],[e.disabled||e.formDisabled,e.n("--not-allowed")])),style:ae({width:e.toSizeUnit(e.buttonSize),height:e.toSizeUnit(e.buttonSize)}),round:"","var-counter-cover":"",ripple:e.ripple&&e.incrementButton&&!e.disabled&&!e.formDisabled&&!e.readonly&&!e.formReadonly&&!e.disableIncrement&&!e.isMax,onClick:e.increment,onTouchstart:e.pressIncrement,onTouchend:e.releaseIncrement,onTouchcancel:e.releaseIncrement},{default:R(()=>[y(B,{name:"plus"})]),_:1},8,["class","style","ripple","onClick","onTouchstart","onTouchend","onTouchcancel"])],16),y(b,{"error-message":e.errorMessage},null,8,["error-message"])],2)}const he=ve({name:Ke,components:{VarButton:De,VarIcon:ye,VarFormDetails:Te},directives:{Ripple:ze},inheritAttrs:!1,props:pe,setup(e){const h=V(""),{bindForm:B,form:k}=Be(),{errorMessage:b,validateWithTrigger:w,validate:F,resetValidation:_}=be(),{readonly:l,disabled:f}=k??{},r=se(()=>{const{max:n,modelValue:t}=e;return n!=null&&o(t)>=o(n)}),m=se(()=>{const{min:n,modelValue:t}=e;return n!=null&&o(t)<=o(n)});let D,$,T,g;S(B,{reset:A,validate:v,resetValidation:_}),fe(()=>e.modelValue,n=>{z(i(String(n))),S(e.onChange,o(n))}),z(i(String(e.modelValue)));function v(){return F(e.rules,e.modelValue)}function s(n){Fe(()=>{const{validateTrigger:t,rules:c,modelValue:a}=e;w(t,n,c,a)})}function A(){const{min:n}=e;S(e["onUpdate:modelValue"],n!=null?o(n):0),_()}function i(n){const{decimalLength:t,max:c,min:a}=e;let d=o(n);return c!=null&&d>o(c)&&(d=o(c)),a!=null&&d<o(a)&&(d=o(a)),n=String(d),t!=null&&(n=d.toFixed(o(t))),n}function p(n){const{lazyChange:t,onBeforeChange:c}=e,{value:a}=n.target,d=i(a);t?S(c,o(d),L):z(d),s("onInputChange")}function q(){const{disabled:n,readonly:t,disableDecrement:c,decrementButton:a,lazyChange:d,step:X,modelValue:Z,onDecrement:x,onBeforeChange:ee}=e;if(f!=null&&f.value||l!=null&&l.value||n||t||c||!a||m.value)return;const ne=new G(o(Z)).minus(new G(o(X))).toString(),U=i(ne),M=o(U);S(x,M),d?S(ee,M,L):(z(U),s("onDecrement"))}function O(){const{disabled:n,readonly:t,disableIncrement:c,incrementButton:a,lazyChange:d,step:X,modelValue:Z,onIncrement:x,onBeforeChange:ee}=e;if(f!=null&&f.value||l!=null&&l.value||n||t||c||!a||r.value)return;const ne=new G(o(Z)).plus(new G(o(X))).toString(),U=i(ne),M=o(U);S(x,M),d?S(ee,M,L):(z(U),s("onIncrement"))}function Q(){const{press:n,lazyChange:t}=e;!n||t||(g=window.setTimeout(()=>{Y()},ce))}function C(){const{press:n,lazyChange:t}=e;!n||t||(T=window.setTimeout(()=>{W()},ce))}function u(){$&&clearTimeout($),g&&clearTimeout(g)}function I(){D&&clearTimeout(D),T&&clearTimeout(T)}function W(){D=window.setTimeout(()=>{O(),W()},me)}function Y(){$=window.setTimeout(()=>{q(),Y()},me)}function z(n){h.value=n;const t=o(n);S(e["onUpdate:modelValue"],t)}function L(n){z(i(String(n))),s("onLazyChange")}return{inputValue:h,errorMessage:b,formDisabled:f,formReadonly:l,isMax:r,isMin:m,n:Qe,classes:Xe,formatElevation:Ce,validate:v,reset:A,resetValidation:_,handleChange:p,decrement:q,increment:O,pressDecrement:Q,pressIncrement:C,releaseDecrement:u,releaseIncrement:I,toSizeUnit:Se,toNumber:o}}});he.render=xe;var re=he;Ve(re);we(re,pe);const en=re;const nn={class:"main-content"},tn={class:"card-list"},an={class:"switch"},on=ve({__name:"ChartListView",setup(e){const h=Oe(),B=We(),{dealListGroup:k}=Ge(),{categoryOptions:b,dayOptions:w,monthOptions:F,yearOptions:_}=Ue(),l=V(),f=V([]);let{type:r,time:m}=h.query;m||(m=`${H().yearStr}-${H().monthStr}`),r||(r="year");let[D,$]=m.split("-");const T=V(!1),g=V(r==="month"),K=V(0),v=V(+D),s=V(`${D}-${$}`),A=C=>{r==="category"?B.push({name:"List",query:{list:"deal",time:g.value?v.value:s.value,keyword:C.name}}):B.push({name:"List",query:{list:"deal",time:C.name}})},i=C=>{f.value=[];let u=0;k(r,{time:C,type:"out"}).forEach(I=>{f.value.push({id:u,name:I.name,desc:`${I.value.length}笔`,amount:I.total}),u++})};fe(()=>f.value,()=>{K.value=He(f.value.reduce((C,u)=>Je(le(C),le(u.amount)),le(0)))});const p=V("分类统计");r==="day"?(D===H().yearStr?p.value=`${(+$).toString()}月支出`:p.value=`${D}年${$}月支出`,l.value=w(m),i(m)):r==="month"?(p.value=`${m}年支出`,l.value=F(m),i(m)):r==="year"?(p.value="全部支出",l.value=_(),i()):r==="category"&&(l.value=b(m),i(m));const q=()=>{g.value=!g.value,g.value?(l.value=b(v.value.toString()),i(v.value.toString())):(l.value=b(s.value),i(s.value))},O=()=>{r==="day"?(l.value=w(s.value),s.value.split("-")[0]===H().yearStr?p.value=`${+s.value.split("-")[1].toString()}月支出`:p.value=`${s.value.replace("-","年")}月支出`):r==="category"&&(l.value=b(s.value)),i(s.value),setTimeout(()=>{T.value=!1},30)},Q=()=>{r==="month"?(l.value=F(v.value.toString()),p.value=`${v.value}年支出`):r==="category"&&(l.value=b(v.value.toString())),i(v.value.toString())};return(C,u)=>{const I=Ne,W=en,Y=ke,z=Me,L=Le,n=_e,t=Ie,c=$e;return N(),J(de,null,[y(I,{title:p.value,back:!0},null,8,["title"]),E("div",nn,[E("div",tn,[E("div",an,[g.value?(N(),oe(W,{key:0,modelValue:v.value,"onUpdate:modelValue":u[0]||(u[0]=a=>v.value=a),onChange:Q},null,8,["modelValue"])):!g.value&&ie(h).query.time?(N(),J("div",{key:1,class:"switch__date",onClick:u[1]||(u[1]=a=>T.value=!0)},Ae(s.value),1)):ue("",!0),ie(r)==="category"?(N(),oe(Y,{key:2,class:"switch__btn",size:"mini",onClick:q},{default:R(()=>[Ye(" 切换 ")]),_:1})):ue("",!0)]),y(z,{title:p.value,amount:K.value,option:l.value,more:!1},null,8,["title","amount","option"]),(N(!0),J(de,null,qe(f.value,a=>(N(),oe(n,{header:!1,key:a.id,class:"padding-small"},{default:R(()=>[y(L,{item:a,onClick:d=>A(a)},null,8,["item","onClick"])]),_:2},1024))),128))])]),y(c,{show:T.value,"onUpdate:show":u[3]||(u[3]=a=>T.value=a)},{default:R(()=>[y(t,{modelValue:s.value,"onUpdate:modelValue":u[2]||(u[2]=a=>s.value=a),type:"month",onChange:O},null,8,["modelValue"])]),_:1},8,["show"])],64)}}});const hn=je(on,[["__scopeId","data-v-0514e41a"]]);export{hn as default};
